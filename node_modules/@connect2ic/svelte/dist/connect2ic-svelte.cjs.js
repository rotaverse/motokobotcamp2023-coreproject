!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@xstate/svelte"),require("svelte"),require("svelte/store"),require("svelte/internal")):"function"==typeof define&&define.amd?define(["exports","@xstate/svelte","svelte","svelte/store","svelte/internal"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).Svelte={},e.svelte$1,e.svelte,e.store,e.internal)}(this,(function(e,t,n,o,s){"use strict";const c=Symbol(),r=(e={})=>{const{onConnect:s=(()=>{}),onDisconnect:r=(()=>{})}=e,{client:i}=n.getContext(c),l=t.useSelector(i._service,(e=>e.context.principal)),a=t.useSelector(i._service,(e=>e.context.activeProvider)),d=t.useSelector(i._service,(e=>e)),u=t.useSelector(i._service,(e=>e.value.idle)),p=o.derived(d,((e,t)=>{t(e.matches({idle:"connected"})??!1)})),m=o.derived(d,((e,t)=>t(e.matches({idle:"connecting"})??!1))),v=o.derived(d,((e,t)=>t(e.matches({idle:"intializing"})??!1))),f=o.derived(d,((e,t)=>t(e.matches({idle:"disconnecting"})??!1))),g=o.derived(d,((e,t)=>t(e.matches({idle:"idle"})??!1)));return n.onMount((()=>{const e=i.on("connect",s),t=i.on("disconnect",r);return()=>{e(),t()}})),{principal:l,status:u,activeProvider:a,isInitializing:v,isConnected:p,isConnecting:m,isDisconnecting:f,isIdle:g,connect:e=>{i._service.send({type:"CONNECT",data:{provider:e}})},disconnect:()=>{i._service.send({type:"DISCONNECT"})}}},i=()=>{const{isConnected:e,activeProvider:t}=r(),n=o.derived(t,((e,t)=>t(!!e?.meta.features.includes("wallet"))));return[o.derived([e,n,t],(([e,t,n],o)=>{o(e&&t&&n?n:void 0)})),{loading:o.writable(),error:o.writable()}]};function l(){return{...n.getContext(c).dialog}}function a(e){let t,n,o,c;return{c(){t=s.element("button"),n=s.text("Disconnect"),s.attr(t,"style",e[0]),s.attr(t,"class","connect-button")},m(r,i){s.insert(r,t,i),s.append(t,n),o||(c=s.listen(t,"click",e[8]),o=!0)},p:s.noop,d(e){e&&s.detach(t),o=!1,c()}}}function d(e){let t,n,o,c;return{c(){t=s.element("button"),n=s.text("Connect"),s.attr(t,"style",e[0]),s.attr(t,"class","connect-button")},m(r,i){s.insert(r,t,i),s.append(t,n),o||(c=s.listen(t,"click",e[9]),o=!0)},p:s.noop,d(e){e&&s.detach(t),o=!1,c()}}}function u(e){let t,n,o=e[1]&&a(e),c=!e[1]&&d(e);return{c(){o&&o.c(),t=s.space(),c&&c.c(),n=s.empty()},m(e,r){o&&o.m(e,r),s.insert(e,t,r),c&&c.m(e,r),s.insert(e,n,r)},p(e,[s]){e[1]?o?o.p(e,s):(o=a(e),o.c(),o.m(t.parentNode,t)):o&&(o.d(1),o=null),e[1]?c&&(c.d(1),c=null):c?c.p(e,s):(c=d(e),c.c(),c.m(n.parentNode,n))},i:s.noop,o:s.noop,d(e){o&&o.d(e),e&&s.detach(t),c&&c.d(e),e&&s.detach(n)}}}function p(e,t,n){let o;const c=()=>{},i=()=>{},{open:a}=l(),{isConnected:d,disconnect:u}=r({onConnect:c,onDisconnect:i});s.component_subscribe(e,d,(e=>n(1,o=e)));return["",o,a,d,u,c,i,!1,()=>u(),()=>a()]}class m extends s.SvelteComponent{constructor(e){super(),s.init(this,e,p,u,s.safe_not_equal,{onConnect:5,onDisconnect:6,dark:7,style:0})}get onConnect(){return this.$$.ctx[5]}get onDisconnect(){return this.$$.ctx[6]}get dark(){return this.$$.ctx[7]}get style(){return this.$$.ctx[0]}}function v(e,t,n){const o=e.slice();return o[11]=t[n],o}function f(e){let t,n,o,c,r,i,l=e[3],a=[];for(let t=0;t<l.length;t+=1)a[t]=g(v(e,l,t));return{c(){t=s.element("div"),n=s.element("div"),o=s.element("div");for(let e=0;e<a.length;e+=1)a[e].c();s.attr(n,"class","dialog-container"),s.attr(t,"class",c="dialog-styles "+(e[1]?"dark":"light"))},m(c,l){s.insert(c,t,l),s.append(t,n),s.append(n,o);for(let e=0;e<a.length;e+=1)a[e].m(o,null);r||(i=[s.listen(n,"click",e[4]),s.listen(t,"click",(function(){s.is_function(e[0])&&e[0].apply(this,arguments)}))],r=!0)},p(n,r){if(e=n,138&r){let t;for(l=e[3],t=0;t<l.length;t+=1){const n=v(e,l,t);a[t]?a[t].p(n,r):(a[t]=g(n),a[t].c(),a[t].m(o,null))}for(;t<a.length;t+=1)a[t].d(1);a.length=l.length}2&r&&c!==(c="dialog-styles "+(e[1]?"dark":"light"))&&s.attr(t,"class",c)},d(e){e&&s.detach(t),s.destroy_each(a,e),r=!1,s.run_all(i)}}}function g(e){let t,n,o,c,r,i,l,a,d,u,p,m,v=e[11].meta.name+"";function f(){return e[8](e[11])}return{c(){t=s.element("button"),n=s.element("img"),c=s.space(),r=s.element("div"),i=s.element("span"),l=s.text(v),a=s.space(),s.attr(n,"class","img-styles"),s.src_url_equal(n.src,o=e[1]?e[11].meta.icon.dark:e[11].meta.icon.light)||s.attr(n,"src",o),s.attr(i,"class","button-label"),s.attr(t,"key",d=e[11].meta.id),s.attr(t,"class",u=`button-styles ${e[11].meta.id}-styles`)},m(e,o){s.insert(e,t,o),s.append(t,n),s.append(t,c),s.append(t,r),s.append(r,i),s.append(i,l),s.append(t,a),p||(m=s.listen(t,"click",f),p=!0)},p(c,r){e=c,10&r&&!s.src_url_equal(n.src,o=e[1]?e[11].meta.icon.dark:e[11].meta.icon.light)&&s.attr(n,"src",o),8&r&&v!==(v=e[11].meta.name+"")&&s.set_data(l,v),8&r&&d!==(d=e[11].meta.id)&&s.attr(t,"key",d),8&r&&u!==(u=`button-styles ${e[11].meta.id}-styles`)&&s.attr(t,"class",u)},d(e){e&&s.detach(t),p=!1,m()}}}function _(e){let t,n=e[2]&&f(e);return{c(){n&&n.c(),t=s.empty()},m(e,o){n&&n.m(e,o),s.insert(e,t,o)},p(e,[o]){e[2]?n?n.p(e,o):(n=f(e),n.c(),n.m(t.parentNode,t)):n&&(n.d(1),n=null)},i:s.noop,o:s.noop,d(e){n&&n.d(e),e&&s.detach(t)}}}function h(e,o,i){let a,d,{onClose:u=(()=>{v()})}=o,{dark:p=!1}=o;const{isOpen:m,close:v,open:f}=l();s.component_subscribe(e,m,(e=>i(2,a=e)));const g=function(){const e=n.getContext(c);return t.useSelector(e.client._service,(e=>e.context.providers))}();s.component_subscribe(e,g,(e=>i(3,d=e)));const{connect:_}=r({onConnect:()=>{v()}});a&&(document.body.style.overflow="hidden"),a||(document.body.style.overflow="unset"),n.onMount((()=>{const e=e=>{27===e.keyCode&&v()};return window.addEventListener("keydown",e),()=>{window.removeEventListener("keydown",e)}}));return e.$$set=e=>{"onClose"in e&&i(0,u=e.onClose),"dark"in e&&i(1,p=e.dark)},[u,p,a,d,e=>{e.stopPropagation()},m,g,_,e=>_(e.meta.id)]}class y extends s.SvelteComponent{constructor(e){super(),s.init(this,e,h,_,s.safe_not_equal,{onClose:0,dark:1})}}function b(e){let t;const n=e[3].default,o=s.create_slot(n,e,e[2],null);return{c(){o&&o.c()},m(e,n){o&&o.m(e,n),t=!0},p(e,[c]){o&&o.p&&(!t||4&c)&&s.update_slot_base(o,n,e,e[2],t?s.get_slot_changes(n,e[2],c,null):s.get_all_dirty_from_scope(e[2]),null)},i(e){t||(s.transition_in(o,e),t=!0)},o(e){s.transition_out(o,e),t=!1},d(e){o&&o.d(e)}}}function C(e,t,r){let i,{$$slots:l={},$$scope:a}=t,{client:d}=t,u=o.writable(!1);s.component_subscribe(e,u,(e=>r(4,i=e)));const p={open:()=>{s.set_store_value(u,i=!0,i)},close:()=>{s.set_store_value(u,i=!1,i)},isOpen:u};return o.writable(void 0),n.setContext(c,{client:d,dialog:p}),e.$$set=e=>{"client"in e&&r(1,d=e.client),"$$scope"in e&&r(2,a=e.$$scope)},[u,d,a,l]}class x extends s.SvelteComponent{constructor(e){super(),s.init(this,e,C,b,s.safe_not_equal,{client:1})}}e.Connect2ICProvider=x,e.ConnectButton=m,e.ConnectDialog=y,e.useBalance=()=>{const[e]=i(),{activeProvider:t}=r(),n=o.writable(),s=o.writable(!0),c=o.writable(),l=async()=>{const n=o.get(e),r=o.get(t);if(!n||!r)return void c.set(void 0);const i=await(r.queryBalance?.());return c.set(i),s.set(!1),i};return e.subscribe((()=>{o.get(e)&&l()})),[c,{loading:s,error:n,refetch:l}]},e.useCanister=(e,s={mode:"auto"})=>{const{mode:i}=s,{client:l}=n.getContext(c),a=t.useSelector(l._service,(t=>t.context.anonymousActors[e])),d=t.useSelector(l._service,(t=>t.context.actors[e])),{isConnected:u}=r(),p=o.derived([u,d,a],(([e,t,n],o)=>{o(e&&t&&"anonymous"!==i?t:n)}));return[p,{error:!1,loading:o.derived(p,((e,t)=>t(!e)))}]},e.useConnect=r,e.useTransfer=({amount:e,to:t})=>{const[n]=i(),{activeProvider:s,principal:c}=r(),l=o.writable(!0),a=o.writable();return[async()=>{const c=o.get(n),r=o.get(s);if(!c||!r)return;l.set(!0);const i=await(r.requestTransfer?.({amount:e,to:t}).catch((e=>{a.set(e)})));return l.set(!1),i},{loading:l,error:a}]},e.useWallet=i,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=connect2ic-svelte.cjs.js.map
