import{useSelector as t}from"@xstate/svelte";import{getContext as e,onMount as n,setContext as o}from"svelte";import{derived as c,writable as s,get as i}from"svelte/store";import{SvelteComponent as r,init as l,safe_not_equal as d,element as a,text as u,attr as m,insert as p,append as v,listen as f,noop as g,detach as y,space as h,empty as $,component_subscribe as k,is_function as C,src_url_equal as b,set_data as x,destroy_each as w,run_all as _,create_slot as D,update_slot_base as N,get_all_dirty_from_scope as P,get_slot_changes as E,transition_in as O,transition_out as I,set_store_value as T}from"svelte/internal";const q=Symbol(),z=(o={})=>{const{onConnect:s=(()=>{}),onDisconnect:i=(()=>{})}=o,{client:r}=e(q),l=t(r._service,(t=>t.context.principal)),d=t(r._service,(t=>t.context.activeProvider)),a=t(r._service,(t=>t)),u=t(r._service,(t=>t.value.idle)),m=c(a,((t,e)=>{e(t.matches({idle:"connected"})??!1)})),p=c(a,((t,e)=>e(t.matches({idle:"connecting"})??!1))),v=c(a,((t,e)=>e(t.matches({idle:"intializing"})??!1))),f=c(a,((t,e)=>e(t.matches({idle:"disconnecting"})??!1))),g=c(a,((t,e)=>e(t.matches({idle:"idle"})??!1)));return n((()=>{const t=r.on("connect",s),e=r.on("disconnect",i);return()=>{t(),e()}})),{principal:l,status:u,activeProvider:d,isInitializing:v,isConnected:m,isConnecting:p,isDisconnecting:f,isIdle:g,connect:t=>{r._service.send({type:"CONNECT",data:{provider:t}})},disconnect:()=>{r._service.send({type:"DISCONNECT"})}}},L=(n,o={mode:"auto"})=>{const{mode:s}=o,{client:i}=e(q),r=t(i._service,(t=>t.context.anonymousActors[n])),l=t(i._service,(t=>t.context.actors[n])),{isConnected:d}=z(),a=c([d,l,r],(([t,e,n],o)=>{o(t&&e&&"anonymous"!==s?e:n)}));return[a,{error:!1,loading:c(a,((t,e)=>e(!t)))}]},S=()=>{const{isConnected:t,activeProvider:e}=z(),n=c(e,((t,e)=>e(!!t?.meta.features.includes("wallet"))));return[c([t,n,e],(([t,e,n],o)=>{o(t&&e&&n?n:void 0)})),{loading:s(),error:s()}]},A=()=>{const[t]=S(),{activeProvider:e}=z(),n=s(),o=s(!0),c=s(),r=async()=>{const n=i(t),s=i(e);if(!n||!s)return void c.set(void 0);const r=await(s.queryBalance?.());return c.set(r),o.set(!1),r};return t.subscribe((()=>{i(t)&&r()})),[c,{loading:o,error:n,refetch:r}]},B=({amount:t,to:e})=>{const[n]=S(),{activeProvider:o,principal:c}=z(),r=s(!0),l=s();return[async()=>{const c=i(n),s=i(o);if(!c||!s)return;r.set(!0);const d=await(s.requestTransfer?.({amount:t,to:e}).catch((t=>{l.set(t)})));return r.set(!1),d},{loading:r,error:l}]};function j(){return{...e(q).dialog}}function F(t){let e,n,o,c;return{c(){e=a("button"),n=u("Disconnect"),m(e,"style",t[0]),m(e,"class","connect-button")},m(s,i){p(s,e,i),v(e,n),o||(c=f(e,"click",t[8]),o=!0)},p:g,d(t){t&&y(e),o=!1,c()}}}function G(t){let e,n,o,c;return{c(){e=a("button"),n=u("Connect"),m(e,"style",t[0]),m(e,"class","connect-button")},m(s,i){p(s,e,i),v(e,n),o||(c=f(e,"click",t[9]),o=!0)},p:g,d(t){t&&y(e),o=!1,c()}}}function H(t){let e,n,o=t[1]&&F(t),c=!t[1]&&G(t);return{c(){o&&o.c(),e=h(),c&&c.c(),n=$()},m(t,s){o&&o.m(t,s),p(t,e,s),c&&c.m(t,s),p(t,n,s)},p(t,[s]){t[1]?o?o.p(t,s):(o=F(t),o.c(),o.m(e.parentNode,e)):o&&(o.d(1),o=null),t[1]?c&&(c.d(1),c=null):c?c.p(t,s):(c=G(t),c.c(),c.m(n.parentNode,n))},i:g,o:g,d(t){o&&o.d(t),t&&y(e),c&&c.d(t),t&&y(n)}}}function J(t,e,n){let o;const c=()=>{},s=()=>{},{open:i}=j(),{isConnected:r,disconnect:l}=z({onConnect:c,onDisconnect:s});k(t,r,(t=>n(1,o=t)));return["",o,i,r,l,c,s,!1,()=>l(),()=>i()]}class K extends r{constructor(t){super(),l(this,t,J,H,d,{onConnect:5,onDisconnect:6,dark:7,style:0})}get onConnect(){return this.$$.ctx[5]}get onDisconnect(){return this.$$.ctx[6]}get dark(){return this.$$.ctx[7]}get style(){return this.$$.ctx[0]}}function M(t,e,n){const o=t.slice();return o[11]=e[n],o}function Q(t){let e,n,o,c,s,i,r=t[3],l=[];for(let e=0;e<r.length;e+=1)l[e]=R(M(t,r,e));return{c(){e=a("div"),n=a("div"),o=a("div");for(let t=0;t<l.length;t+=1)l[t].c();m(n,"class","dialog-container"),m(e,"class",c="dialog-styles "+(t[1]?"dark":"light"))},m(c,r){p(c,e,r),v(e,n),v(n,o);for(let t=0;t<l.length;t+=1)l[t].m(o,null);s||(i=[f(n,"click",t[4]),f(e,"click",(function(){C(t[0])&&t[0].apply(this,arguments)}))],s=!0)},p(n,s){if(t=n,138&s){let e;for(r=t[3],e=0;e<r.length;e+=1){const n=M(t,r,e);l[e]?l[e].p(n,s):(l[e]=R(n),l[e].c(),l[e].m(o,null))}for(;e<l.length;e+=1)l[e].d(1);l.length=r.length}2&s&&c!==(c="dialog-styles "+(t[1]?"dark":"light"))&&m(e,"class",c)},d(t){t&&y(e),w(l,t),s=!1,_(i)}}}function R(t){let e,n,o,c,s,i,r,l,d,g,$,k,C=t[11].meta.name+"";function w(){return t[8](t[11])}return{c(){e=a("button"),n=a("img"),c=h(),s=a("div"),i=a("span"),r=u(C),l=h(),m(n,"class","img-styles"),b(n.src,o=t[1]?t[11].meta.icon.dark:t[11].meta.icon.light)||m(n,"src",o),m(i,"class","button-label"),m(e,"key",d=t[11].meta.id),m(e,"class",g=`button-styles ${t[11].meta.id}-styles`)},m(t,o){p(t,e,o),v(e,n),v(e,c),v(e,s),v(s,i),v(i,r),v(e,l),$||(k=f(e,"click",w),$=!0)},p(c,s){t=c,10&s&&!b(n.src,o=t[1]?t[11].meta.icon.dark:t[11].meta.icon.light)&&m(n,"src",o),8&s&&C!==(C=t[11].meta.name+"")&&x(r,C),8&s&&d!==(d=t[11].meta.id)&&m(e,"key",d),8&s&&g!==(g=`button-styles ${t[11].meta.id}-styles`)&&m(e,"class",g)},d(t){t&&y(e),$=!1,k()}}}function U(t){let e,n=t[2]&&Q(t);return{c(){n&&n.c(),e=$()},m(t,o){n&&n.m(t,o),p(t,e,o)},p(t,[o]){t[2]?n?n.p(t,o):(n=Q(t),n.c(),n.m(e.parentNode,e)):n&&(n.d(1),n=null)},i:g,o:g,d(t){n&&n.d(t),t&&y(e)}}}function V(o,c,s){let i,r,{onClose:l=(()=>{u()})}=c,{dark:d=!1}=c;const{isOpen:a,close:u,open:m}=j();k(o,a,(t=>s(2,i=t)));const p=function(){const n=e(q);return t(n.client._service,(t=>t.context.providers))}();k(o,p,(t=>s(3,r=t)));const{connect:v}=z({onConnect:()=>{u()}});i&&(document.body.style.overflow="hidden"),i||(document.body.style.overflow="unset"),n((()=>{const t=t=>{27===t.keyCode&&u()};return window.addEventListener("keydown",t),()=>{window.removeEventListener("keydown",t)}}));return o.$$set=t=>{"onClose"in t&&s(0,l=t.onClose),"dark"in t&&s(1,d=t.dark)},[l,d,i,r,t=>{t.stopPropagation()},a,p,v,t=>v(t.meta.id)]}class W extends r{constructor(t){super(),l(this,t,V,U,d,{onClose:0,dark:1})}}function X(t){let e;const n=t[3].default,o=D(n,t,t[2],null);return{c(){o&&o.c()},m(t,n){o&&o.m(t,n),e=!0},p(t,[c]){o&&o.p&&(!e||4&c)&&N(o,n,t,t[2],e?E(n,t[2],c,null):P(t[2]),null)},i(t){e||(O(o,t),e=!0)},o(t){I(o,t),e=!1},d(t){o&&o.d(t)}}}function Y(t,e,n){let c,{$$slots:i={},$$scope:r}=e,{client:l}=e,d=s(!1);k(t,d,(t=>n(4,c=t)));const a={open:()=>{T(d,c=!0,c)},close:()=>{T(d,c=!1,c)},isOpen:d};return s(void 0),o(q,{client:l,dialog:a}),t.$$set=t=>{"client"in t&&n(1,l=t.client),"$$scope"in t&&n(2,r=t.$$scope)},[d,l,r,i]}class Z extends r{constructor(t){super(),l(this,t,Y,X,d,{client:1})}}export{Z as Connect2ICProvider,K as ConnectButton,W as ConnectDialog,A as useBalance,L as useCanister,z as useConnect,B as useTransfer,S as useWallet};
//# sourceMappingURL=connect2ic-svelte.esm.js.map
